{% extends 'base.html' %}
{% load static %} 

{% block title %}Comunidades - Jornal Commercio{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'jornal_commercio/css/comunidades_lista.css' %}">
{% endblock %}

{% block content %}
<div class="container-principal-comunidades">

    <header class="comunidades-cabecalho">
        <h2>Comunidades</h2>
        
        <div class="comunidades-filtros">
            <form class="filtro-busca" method="GET" action="{% url 'comunidades_lista' %}">
                <input type="text" name="q" placeholder="Busca" value="{{ search_query }}">
                {% if filtro_ativo != 'alta' %}
                    <input type="hidden" name="filtro" value="{{ filtro_ativo }}">
                {% endif %}
            </form>

            <nav class="filtro-abas">
                <a href="?filtro=alta{% if search_query %}&q={{ search_query }}{% endif %}" class="aba-item {% if filtro_ativo == 'alta' %}aba-ativa{% endif %}">Em Alta</a>
                <a href="?filtro=seguindo{% if search_query %}&q={{ search_query }}{% endif %}" class="aba-item {% if filtro_ativo == 'seguindo' %}aba-ativa{% endif %}">Seguindo</a>
                <a href="?filtro=criados{% if search_query %}&q={{ search_query }}{% endif %}" class="aba-item {% if filtro_ativo == 'criados' %}aba-ativa{% endif %}">Criados por usuários</a>
            </nav>
            
            <button class="filtro-btn">Filtros</button>
        </div>
    </header>

    <div class="comunidade-grid">

        {% for comunidade in comunidades %}
            <a href="{% url 'comunidade_detalhe' pk=comunidade.pk %}" class="comunidade-card">
                
                <div class="card-imagem">
                    {% if comunidade.imagem_card %}
                        <img src="{{ comunidade.imagem_card.url }}" alt="Imagem da comunidade {{ comunidade.nome }}">
                    {% else %}
                        <div class="card-imagem-placeholder">Sem Imagem</div>
                    {% endif %}
                </div>
                
                <div class="card-conteudo">
                    <h3>{{ comunidade.nome }}</h3>
                    
                    <div class="card-info">
                        <span class="info-avatar"></span>
                        <span class="info-autor">{{ comunidade.criador.username }}</span>
                        <span class="info-stats">
                            {{ comunidade.membros.count }}
                        </span>
                    </div>
                </div>
            </a>
        {% empty %}
            {% if search_query %}
                <p>Nenhum resultado encontrado para "{{ search_query }}".</p>
            {% else %}
                <p>Nenhuma comunidade encontrada para este filtro.</p>
            {% endif %}
        {% endfor %}

    </div>

    <div class="paginacao">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if filtro_ativo != 'alta' %}&filtro={{ filtro_ativo }}{% endif %}">Anterior</a>
        {% endif %}

        <span class="pagina-atual">
            Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if filtro_ativo != 'alta' %}&filtro={{ filtro_ativo }}{% endif %}">Próxima</a>
        {% endif %}
    </div>

</div>
{% endblock %}